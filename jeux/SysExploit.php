<?php
session_start();

// Traitement de la validation du jeu
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // RÃ©cupÃ©rer les donnÃ©es POST
    $postData = file_get_contents('php://input');
    parse_str($postData, $data);

    if (isset($data['validated'])) {
        if (!isset($_SESSION['jeuxValides'])) {
            $_SESSION['jeuxValides'] = [];
        }

        // La variable de session est mise Ã  jour en fonction de la valeur string 'true' ou 'false' reÃ§ue du JS.
        // Convertit la chaÃ®ne 'true' en boolÃ©en true, et 'false' en boolÃ©en false.
        $validationResult = ($data['validated'] === 'true');

        // ClÃ© corrigÃ©e : 'SysExp'
        $_SESSION['jeuxValides']['SysExp'] = $validationResult;

        echo json_encode(['success' => true]);
    }
    exit();
}

// Pour une requÃªte GET (chargement de la page), nous nous assurons que la variable existe
// et l'initialisons Ã  false si elle n'a jamais Ã©tÃ© dÃ©finie (premiÃ¨re visite).
if (!isset($_SESSION['jeuxValides']['SysExp'])) {
    if (!isset($_SESSION['jeuxValides'])) {
        $_SESSION['jeuxValides'] = [];
    }
    $_SESSION['jeuxValides']['SysExp'] = false;
}
?>
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SysExploit - Quiz Green IT</title>
    <link rel="stylesheet" href="../css/SysExploit.css">
</head>
<body>
<div class="container">
    <header>
        <h1>ðŸŒ¿ SysExploit</h1>
        <p>Quiz sur les systÃ¨mes d'exploitation open source et le Green IT</p>
    </header>

    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
        <span class="progress-text" id="progressText">Question 1/5</span>
    </div>

    <div class="quiz-container" id="quizContainer">
        <div class="question-card">
            <h2 id="questionText"></h2>
            <div class="answers" id="answersContainer"></div>
        </div>
    </div>

    <div class="navigation">
        <button id="nextBtn" class="btn-next" disabled>Question suivante</button>
    </div>
</div>

<div id="modal" class="modal">
    <div class="modal-content">
        <h2 id="modalTitle"></h2>
        <p id="modalScore"></p>
        <p id="modalMessage"></p>
        <button id="modalBtn" class="btn-modal">Retour Ã  l'accueil</button>
    </div>
</div>

<script src="../js/SysExploit.js"></script>
</body>
</html>